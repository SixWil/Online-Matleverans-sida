<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style-2.css" />
  </head>

  <body style="background-color: rgb(66, 66, 66); margin: 0px">
    <!-- Om man vill ta bort scroll menyn kan man använda: -->
    <!-- overflow: hidden; -->

    <!-- Toppen av sidan, menyn, plus loggan -->
    <div class="top">
      <img
        class="logo"
        src="../../images/Goondora.png"
        alt="logo goes here"
        style="border: solid grey 0.1vw; margin-left: 0.1vw; overflow: hidden"
      />

      <!-- logo placeholder -->
      <!-- <div class="logo" style="width: 10vw; height: 10vw; background-color: lightblue; border-radius: 100%; margin-left: 2.5vw; margin-block: 1vh;"></div> -->

      <!-- logo -->

      <!-- meny -->
      <div class="meny">
        <a href="/start-sida">
          <button class="button-1">Hem</button>
        </a>
        <a href="/om-oss">
          <button class="button-1">Om oss</button>
        </a>
        <% if (username) { %>
          <a href="/anvandare">
              <button class="button-1"><%= username %></button>
          </a>
      <% } else { %>
          <a href="/login">
              <button class="button-1">Konto</button>
          </a>
      <% } %>

        <!-- kundvagn icon placeholder -->
        <!-- <div class="Cart" style="background-color: aquamarine; width: 10vh; height: 10vh; margin-right: 2.5vw; border-radius: 10px; border: 0px;"></div> -->

        <img
          src="../../images/Kundvagn.png"
          alt=""
          style="
            width: 10vh;
            background-color: grey;
            border-radius: 10px;
            border: solid white 0.1vw;
          "
        />
      </div>
    </div>
    <div class="down" style="display: flex; height: 76vh">
      <!-- Sido menyn -->
      <div class="left">
        <a href="/beskrivningar">
          <button class="button-1" style="margin-left: 1vw">BUTIKER:</button>
        </a>
        <input
          id="searchInput"
          placeholder="Sök butik/rätt"
          style="width: 10vw; border-radius: 10px; margin-left: 0.666vw"
        />
        <div class="shops">
          <div class="Shop-1">
            <a href="/Abracadabra/abra-cadabra"
              ><button class="button-2 res_1" style="margin-bottom: 1vh">
                Abra cadabra
              </button></a
            >
            <a href="/Abracadabra/brisket-platter"
              ><button class="button-2" style="margin-top: 1vh">
                Brisket platter
              </button></a
            >
            <a href="/Abracadabra/ribs"
              ><button class="button-2" style="margin-top: 1vh">Ribs</button></a
            >
            <a href="/Abracadabra/kyckling"
              ><button class="button-2" style="margin-top: 1vh">
                Kyckling
              </button></a
            >
          </div>
          <div class="Shop-1">
            <a href="/Agatas/agatas"
              ><button class="button-2 res_1" style="margin-bottom: 1vh">
                Agatas
              </button></a
            >
            <a href="/Agatas/avocado-toast"
              ><button class="button-2" style="margin-top: 1vh">
                Avocado-toast
              </button></a
            >
            <a href="/Agatas/choklad-pudding"
              ><button class="button-2" style="margin-top: 1vh">
                Choklad pudding
              </button></a
            >
            <a href="/Agatas/soppa"
              ><button class="button-2" style="margin-top: 1vh">
                Räk-soppa
              </button></a
            >
          </div>
          <div class="Shop-1">
            <a href="/Pretantieuse/pretentieuse"
              ><button class="button-2 res_1" style="margin-bottom: 1vh">
                Prétentieuse
              </button></a
            >
            <a href="/Pretantieuse/moln"
              ><button class="button-2" style="margin-top: 1vh">
                Di-väte-mono-oxid blandning
              </button></a
            >
            <a href="/Pretantieuse/centaur"
              ><button class="button-2" style="margin-top: 1vh">
                Centaur
              </button></a
            >
            <a href="/Pretantieuse/slag"
              ><button class="button-2" style="margin-top: 1vh">
                Knuckle sandwich
              </button></a
            >
          </div>
        </div>
        <a
          href="https://www.google.se/maps/search/Restauranger"
          target="_blank"
        >
          <button class="button-1" style="margin-left: 1vw">Karta</button>
        </a>
      </div>

      <div class="main-space" style="margin-top: -3vh; display: flex; flex-direction: row; justify-content: space-evenly;">
        <div class="mat-meny" style="height: 100%;">
          <!-- <div class="box-2" style="margin-top: 3vh">
          <p>Beställning</p>
        </div> -->

          <h2 style="width: fit-content; padding-inline: 1vw" class="box-2" id="att_betala">
            Att betala: <%= order[0].payment %> kr <br />
          </h2>

          <!-- 
          function id_ning(klass){
            grupp = querySelectorAll(klass);
            for (let j = 0; j < grupp.length; j++){
              console.log(grupp[j]);
              };
            }
            -->

          <h3
            style="
              overflow-y: scroll;
              height: 50%;
              width: fit-content;
              align-items: center;
              min-width: 10vw;
            "
            class="box-2"
          >
            <% for (let i = 2; i < order.length; i++){ %>

            <div style="display: flex; align-items: center">
              <button
                style="height: 5vh"
                class="minus"
                id="minus_<%=i%>"
                onclick="antal(<%=i%>, -1)"
              >
                -
              </button>

              <div class="sign" style="width: 90%">
                <pre
                  id="mat_<%=i%>"
                > <%= order[i].amount %>st <%= order[i].name %> <br> pris per: <%= order[i].price %> kr <br> pris alla: <%= order[i].total %> kr </pre>
              </div>

              <button
                style="height: 5vh"
                class="pluss"
                id="pluss_<%=i%>"
                onclick="antal('<%=i%>', +1)"
              >
                +
              </button>
            </div>

            <% }%>
          </h3>

          <h3 class="box_2" style="width: fit-content; padding-inline: 1vw" id="betala_detaljer">
            Pris: <%= order[1].cost %> <br />
            Leverans kostnad: <%= order[1].delivery %> <br />
            Skatt: <%= order[1].tax %>
          </h3>

            <button class="button-2" onclick="confirm()" id="Bekräfta-a">
              Bekräfta
            </button>
        </div>
        <%- include('destination') %>
      </div>
    </div>
    
    <script>
      ///                   Straigt up ljuger om att detta är fel                    ///
  
      <% if (message){ %>
        alert("<%= message %>");
      <% } %>;

      
      
      var order_b = <%- JSON.stringify(order) %>; // Embed the server-side `order` array
      
      function antal(i, förändring){
        
        order_b[i].amount += förändring; // Update the amount in the order array
        
        if ( order_b[i].amount < 0 ) { order_b[i].amount = 0 }

        order_b[i].total = order_b[i].amount * order_b[i].price; // Update the total price for the item
        
          enhet = document.getElementById('mat_'+i);
          
          enhet.innerHTML = `${ order_b[i].amount } st ${ order_b[i].name } <br> pris per: ${ order_b[i].price } kr <br> pris alla: ${ order_b[i].total } kr `;

          
          
          order_b[1].cost = 0
          for (let i = 2; i < order_b.length; i++) {
            order_b[1].cost += order_b[i].total; // Calculate the total payment
          };
          
          order_b[1].tax = (order_b[1].cost + order_b[1].delivery) * 0.1
          
          document.getElementById("betala_detaljer").innerHTML =`
          Pris: ${order_b[1].cost} <br>
          Leverans kostnad: ${order_b[1].delivery} <br>
          Skatt: ${order_b[1].tax}`
          
          order_b[0].payment = order_b[1].cost + order_b[1].delivery + order_b[1].tax
          
          document.getElementById("att_betala").innerHTML = `Att betala: ${order_b[0].payment} kr`
        }
        
        var krav_bekräfta = false; // Define the global variable        

        var payment_type;

        var gata;

        
        
        function confirm(){
          
          if (krav_bekräfta){

            var exter = document.getElementById('id_extra-instructions').value
            
            var extra_instructions = document.getElementById('id_extra-instructions')
            
            data_transport = {order_b: order_b, gata: gata, betalning: payment_type, exter: exter }

            fetch('/confirm', {
              method: 'POST',
              headers: {'Content-Type': 'application/json',},
              body: JSON.stringify(data_transport), // Send the `order_b` array as JSON
            })
            
            alert("Beställning bekräftad ")
            window.location.reload()

          } else {alert('Adress eller betalsätt saknas')}
          
        // .then((response) => {
        //   if (response.ok) {
        //     return response.json();
        //   } else {
        //     throw new Error('Failed to confirm order');
        //   }
        // })
        // .then((data) => {
        //   alert(data.message); // Show success or error message
        //   if (data.success) {
        //     window.location.href = '/leverans?message=Beställning+bekräftad'; // Redirect on success
        //   }
        // })
        // .catch((error) => {
        //   console.error('Error confirming order:', error);
        //   alert('An error occurred while confirming the order.');
        // });
        }


    </script>
  </body>
</html>
