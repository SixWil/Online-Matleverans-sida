<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>

    <style>
        /* div {
            overflow-x: scroll;
        } */

        /* .raderna { */
        /* overflow-x: scroll; */
        /* display: flex; */
        /* flex-direction: row; */
        /* background-color: aqua; */
        /* height: 100vh; */
        /* width: 100vw; */
        /* } */

        /* p {
            margin-bottom: 0vw;
        } */
    </style>

</head>

<body>

    <!-- <div style="background-color: rgb(255, 100, 0);"></div>
    <div style="background-color: rgb(255, 133, 0);"></div>
    <div style="background-color: rgb(255, 166, 0);"></div> -->


    <!-- <div> -->
    <!-- data-bs-ride="carousel" -->
    <!-- <div id="carouselExample" class="carousel slide">

        <div class="carousel-inner" style="text-align: center;"> -->

    <div style="background-color: black; height: fit-content; width: fit-content; display: flex;" id="deliveries"
        class="raderna">
        <% const maxLen=Math.max(all.delivery[all.delivery.length - 1].id, all.orders[all.orders.length - 1].id,
            all.users[all.users.length - 1].id) -1; for (let i=0; i < maxLen; i++) { %>
            <div class="collection"
                style="width: fit-content; padding-top: 1vh; padding-inline: 1vw; white-space: nowrap;">
                <% found_delivery_id=all.delivery.find(obj=> obj && obj.id == i)
                    if (found_delivery_id) { %>
                    <div style=" background-color: skyblue; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                        class="card" id="delivery_<%= i %>">

                        <div style="display: flex;" id="delivery_buttons_<%= i %>">
                            <button style="margin-inline: .1vw;"
                                onclick="edit_items('delivery', <%= i %>)">Edit</button>
                            <button style="margin-inline: .1vw;"
                                onclick="del_items('delivery', <%= i %>)">Delete</button>
                        </div>
                        <b>
                            Leverans:
                        </b>
                        <p>
                            id: <%= found_delivery_id.id %>
                        </p>
                        <p>
                            plats: <%= found_delivery_id.address %>
                        </p>
                        <p>
                            betalning: <%= found_delivery_id.payment %>
                        </p>
                        <p>
                            konto: <%= found_delivery_id.account %>
                        </p>
                        <p>
                            paket: <%= found_delivery_id.batch %>
                        </p>
                        <p>
                            extra: <%= found_delivery_id.extra_instructions %>
                        </p>
                    </div>
                    <% } else { %>
                        <div style="opacity: 50%; background-color: skyblue; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                            class="card" id="delivery_<%= i %>">

                            <div style="display: flex;">
                                <button style="margin-inline: .1vw;">Edit</button>
                                <button style="margin-inline: .1vw;">Delete</button>
                            </div>
                            <b>
                                Leverans:
                            </b>
                            <p>
                                id: <%= i %>
                            </p>
                            <p>
                                plats:
                            </p>
                            <p>
                                betalning:
                            </p>
                            <p>
                                konto:
                            </p>
                            <p>
                                paket:
                            </p>
                            <p>
                                extra:
                            </p>
                        </div>
                        <% } %>

                            <% found_order_id=all.orders.find(obj=> obj && obj.id == i)
                                if (found_order_id) { %>
                                <div style=" background-color: orange; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                                    class="card" id="orders_<%= i %>">

                                    <div style="display: flex;" id="orders_buttons_<%= i %>">
                                        <button style="margin-inline: .1vw;"
                                            onclick="edit_items('orders', <%= i %>)">Edit</button>
                                        <button style="margin-inline: .1vw;"
                                            onclick="del_items('orders', <%= i %>)">Delete</button>
                                    </div>

                                    <div>
                                        <b>
                                            Beställning:
                                        </b>
                                        <p>
                                            id: <%= found_order_id.id %>
                                        </p>
                                        <p>
                                            rätt: <%= found_order_id.food %>
                                        </p>
                                        <p>
                                            pris: <%= found_order_id.price_per %>
                                        </p>
                                        <p>
                                            antal: <%= found_order_id.ammount %>
                                        </p>
                                        <p>
                                            konto: <%= found_order_id.account %>
                                        </p>
                                        <p>
                                            paket: <%= found_order_id.batch %>
                                        </p>
                                    </div>
                                </div>
                                <% } else { %>
                                    <div style="opacity: 50%; background-color: orange; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                                        class="card" id="orders_<%= i %>">

                                        <div style="display: flex;">
                                            <button style="margin-inline: .1vw;">Edit</button>
                                            <button style="margin-inline: .1vw;">Delete</button>
                                        </div>

                                        <div>
                                            <b>
                                                Beställning:
                                            </b>
                                            <p>
                                                id: <%= i %>
                                            </p>
                                            <p>
                                                rätt:
                                            </p>
                                            <p>
                                                pris:
                                            </p>
                                            <p>
                                                antal:
                                            </p>
                                            <p>
                                                konto:
                                            </p>
                                            <p>
                                                paket:
                                            </p>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% found_user_id = all.users.find(obj => obj && obj.id == i)
                                                            if (found_user_id) { %>
                                            <div style="white-space: nowrap; background-color: greenyellow; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                                                class="card" id="users_<%= i %>">

                                                <div style="display: flex;" id="users_buttons_<%= i %>">
                                                    <button style="margin-inline: .1vw;"
                                                    onclick="edit_items('users', <%= i %>)">Edit</button>
                                                    <button style="margin-inline: .1vw;"
                                                        onclick="del_items('users', <%= i %>)">Delete</button>
                                                </div>

                                                <b>
                                                    Användare:
                                                </b>

                                                <p>
                                                    id: <%= found_user_id.id %>
                                                </p>
                                                <p>
                                                    namn: <%= found_user_id.username %>
                                                </p>
                                                <p>
                                                    mail: <%= found_user_id.email %>
                                                </p>
                                                <p>
                                                    tel: <%= found_user_id.phone %>
                                                </p>
                                                <p>
                                                    address: <%= found_user_id.address %>
                                                </p>
                                            </div>
                                            <% } else {%>
                                                <div style="white-space: nowrap; opacity: 50%; background-color: greenyellow; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                                                    class="card" id="users_<%= i %>">

                                                    <div style="display: flex;">
                                                        <button style="margin-inline: .1vw;">Edit</button>
                                                        <button style="margin-inline: .1vw;">Delete</button>
                                                    </div>

                                                    <b>
                                                        Användare:
                                                    </b>

                                                    <p>
                                                        id: <%= i %>
                                                    </p>
                                                    <p>
                                                        namn:
                                                    </p>
                                                    <p>
                                                        mail:
                                                    </p>
                                                    <p>
                                                        tel:
                                                    </p>
                                                    <p>
                                                        address:
                                                    </p>
                                                </div>
                                                <% } %>
            </div>
            <% } %>
    </div>



    <script>

        var users = <%- JSON.stringify(all.users) %>;
        var orders = <%- JSON.stringify(all.orders) %>;
        var delivery = <%- JSON.stringify(all.delivery) %>;

        function edit_items(table_name, i) {
            alert("Editing " + table_name + " nr " + (i + 1));
            let table_data;
            if (table_name === 'users') table_data = users;
            else if (table_name === 'orders') table_data = orders;
            else if (table_name === 'delivery') table_data = delivery;

            // Find the object with id === i
            const obj = table_data.find(obj => obj && obj.id === i);

            // document.getElementById(`${table_name}_buttons_${i}`).style.backgroundColor = "red";

            card = document.getElementById(`${table_name}_${i}`)
            save = document.getElementById(`${table_name}_buttons_${i}`)
            buttons_old = save.innerHTML;
            save.innerHTML = "<button>Save</button>";
            
            all_items = document.querySelectorAll(`.card`);
            all_items.forEach((item) => {
                item.style.opacity = "50%";
            });
            card.style.opacity = "100%";

            const ps = card.querySelectorAll('p');

            ps.forEach((p) => {
                p.innerHTML = `<input type="text" value="${p.innerText.split(" ")[1]}" placeholder="${p.innerText.split(" ")[0]}">`;
            });

            
            // save.onclick = function() {
            //     save.innerHTML = buttons_old;
            //     all_items.forEach((item) => {
            //         item.style.opacity = "100%";
            //     });
            //     // alert(p);
            //     ps.forEach((p) => {
            //         p.innerHTML = `<p value="${p.innerText}">`;
            //     });
            //     // Save logic here
            //     // You can use the obj variable to access the current object
            //     // and update its properties as needed
            // }
//             if (obj) {
//                 alert(`Editing ${table_name} nr ${i + 1}:
// ${JSON.stringify(obj, null, 1)}`);

//                 const newObj = { obj };
//                 // Prompt for each property
//                 for (const key in newObj) {
//                     if (key !== 'id') {
//                         const newValue = prompt(`Enter new value for ${key} (${newObj[key]}):`, newObj[key]);
//                         if (newValue !== null) {
//                             newObj[key] = newValue;
//                         }
//                     }
//                 }

//                 fetch(`/nimdA/edit/row`, {
//                     method: 'POST',
//                     headers: { 'Content-Type': 'application/json' },
//                     body: JSON.stringify({
//                         table_name,
//                         id: obj.id,
//                         data: newObj
//                     })
//                 })
//             } else {
//                 alert("Item not found");
//             }
        }

        function del_items(table_name, i) {
            let table_data;
            if (table_name === 'users') table_data = users;
            else if (table_name === 'orders') table_data = orders;
            else if (table_name === 'delivery') table_data = delivery;

            // Find the object with id === i
            const obj = table_data.find(obj => obj && obj.id === i);

            if (
                obj && confirm(`Are you sure you want to delete ${table_name} nr ${i + 1}?
${JSON.stringify(obj, null, 1)}`)
            ) {
                fetch(`/nimdA/delete/row`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        table_name,
                        id: obj.id
                    })
                })
                // Replace the card with a blank version instead of removing it
                const card = document.getElementById(`${table_name}_${i}`);
                let blankHtml = '';
                if (table_name === 'delivery') {
                    blankHtml = `
                        <div style="opacity: 50%; background-color: skyblue; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                            class="card" id="delivery_${i}">
                            <div style="display: flex;">
                                <button style="margin-inline: .1vw;">Edit</button>
                                <button style="margin-inline: .1vw;">Delete</button>
                            </div>
                            <b>Leverans:</b>
                            <p>id: ${i}</p>
                            <p>plats:</p>
                            <p>betalning:</p>
                            <p>konto:</p>
                            <p>paket:</p>
                            <p>extra:</p>
                        </div>
                    `;
                } else if (table_name === 'orders') {
                    blankHtml = `
                        <div style="background-color: orange; min-width: 100%; opacity: 50%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                            class="card" id="orders_${i}">
                            <div style="display: flex;">
                                <button style="margin-inline: .1vw;">Edit</button>
                                <button style="margin-inline: .1vw;">Delete</button>
                            </div>
                            <b>Beställning:</b>
                            <p>id: ${i}</p>
                            <p>rätt:</p>
                            <p>pris:</p>
                            <p>antal:</p>
                            <p>konto:</p>
                            <p>paket:</p>
                        </div>
                    `;
                } else if (table_name === 'users') {
                    blankHtml = `
                        <div style="white-space: nowrap; opacity: 50%; background-color: greenyellow; min-width: 100%; width: fit-content; height: fit-content; text-align: center; margin-block: 1vh; padding-inline: 1vw; padding-block: 1vh; align-items: center;"
                            class="card" id="users_${i}">
                            <div style="display: flex;">
                                <button>Edit</button>
                                <button>Delete</button>
                            </div>
                            <b>Användare:</b>
                            <p>id: ${i}</p>
                            <p>namn:</p>
                            <p>mail:</p>
                            <p>tel:</p>
                            <p>address:</p>
                        </div>
                    `;
                }
                card.outerHTML = blankHtml;

                // Set the deleted object to null in the array
                const idx = table_data.findIndex(obj => obj && obj.id === i);
                if (idx !== -1) table_data[idx] = null;

                alert("(Deleted item)")
            } else {
                alert("(Deletion canceled)")
            }
        }

    </script>

</body>

</html>